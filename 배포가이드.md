# 배포 가이드: GitHub → Streamlit Cloud

본 가이드는 인사회계 시스템을 GitHub에 업로드하고 Streamlit Cloud로 배포하는 전체 절차를 단계별로 설명합니다.

---

## 📋 목차

1. [사전 준비](#1-사전-준비)
2. [Supabase 데이터베이스 설정](#2-supabase-데이터베이스-설정)
3. [GitHub 저장소 생성 및 업로드](#3-github-저장소-생성-및-업로드)
4. [Streamlit Cloud 배포](#4-streamlit-cloud-배포)
5. [배포 확인 및 테스트](#5-배포-확인-및-테스트)
6. [문제 해결](#6-문제-해결)

---

## 1. 사전 준비

### 1.1 필요한 계정

다음 서비스의 계정을 미리 생성하세요:

#### ✅ Supabase 계정
- 웹사이트: https://supabase.com
- 가입: 무료 (월 500MB 데이터베이스)
- 용도: PostgreSQL 데이터베이스

#### ✅ GitHub 계정
- 웹사이트: https://github.com
- 가입: 무료
- 용도: 소스 코드 저장소

#### ✅ Streamlit Cloud 계정
- 웹사이트: https://streamlit.io/cloud
- 가입: GitHub 계정으로 로그인 (무료)
- 용도: 웹 애플리케이션 호스팅

### 1.2 로컬 환경 준비

**필수 소프트웨어 설치**:

```bash
# 1. Python 설치 확인 (3.8 이상)
python --version
# 또는
python3 --version

# 2. Git 설치 확인
git --version

# 3. Git 미설치 시 설치
# Windows: https://git-scm.com/download/win
# Mac: brew install git
# Linux: sudo apt-get install git
```

### 1.3 프로젝트 파일 준비

다음 파일들이 준비되어 있는지 확인하세요:

```
hr-accounting-system/
├── hr_accounting_system.py      # 메인 애플리케이션
├── requirements.txt              # Python 패키지 목록
├── README.md                     # 프로젝트 설명
├── .gitignore                    # Git 제외 파일 목록
└── .streamlit/
    └── secrets.toml              # 로컬 개발용 (GitHub 업로드 금지!)
```

---

## 2. Supabase 데이터베이스 설정

### 2.1 Supabase 프로젝트 생성

**Step 1: Supabase 대시보드 접속**
```
1. https://app.supabase.com 접속
2. 로그인 또는 회원가입
3. "New Project" 버튼 클릭
```

**Step 2: 프로젝트 정보 입력**
```
Project Name: hr-accounting-system
Database Password: [안전한 비밀번호 생성]
  예: Myp@ssw0rd!2024
Region: Northeast Asia (Seoul) 선택
Pricing Plan: Free
```

**Step 3: 프로젝트 생성 완료 대기**
- 약 2-3분 소요
- 진행률 표시줄 확인

### 2.2 데이터베이스 테이블 생성

**Step 1: SQL Editor 열기**
```
1. 좌측 메뉴에서 "SQL Editor" 클릭
2. "New Query" 버튼 클릭
```

**Step 2: 테이블 생성 SQL 실행**

아래 SQL을 복사하여 붙여넣고 "Run" 버튼 클릭:

```sql
-- 1. 직원 테이블
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    employee_code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    department VARCHAR(50),
    position VARCHAR(50),
    hire_date DATE,
    salary NUMERIC(15,2),
    phone VARCHAR(20),
    email VARCHAR(100),
    status VARCHAR(20) DEFAULT '재직중',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 2. 급여 테이블
CREATE TABLE payroll (
    id SERIAL PRIMARY KEY,
    employee_code VARCHAR(20) REFERENCES employees(employee_code),
    payment_date DATE NOT NULL,
    base_salary NUMERIC(15,2),
    bonus NUMERIC(15,2) DEFAULT 0,
    deduction NUMERIC(15,2) DEFAULT 0,
    net_salary NUMERIC(15,2),
    remarks TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 3. 거래처 테이블
CREATE TABLE clients (
    id SERIAL PRIMARY KEY,
    client_code VARCHAR(20) UNIQUE NOT NULL,
    client_name VARCHAR(200) NOT NULL,
    business_type VARCHAR(50),
    country VARCHAR(50),
    contact_person VARCHAR(100),
    phone VARCHAR(20),
    email VARCHAR(100),
    address TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 4. 매출 테이블
CREATE TABLE sales (
    id SERIAL PRIMARY KEY,
    sales_no VARCHAR(30) UNIQUE NOT NULL,
    sales_date DATE NOT NULL,
    client_code VARCHAR(20) REFERENCES clients(client_code),
    product_name VARCHAR(200),
    quantity NUMERIC(15,2),
    unit_price NUMERIC(15,2),
    amount NUMERIC(15,2),
    currency VARCHAR(10) DEFAULT 'KRW',
    payment_status VARCHAR(20) DEFAULT '미수금',
    remarks TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 5. 매입 테이블
CREATE TABLE purchases (
    id SERIAL PRIMARY KEY,
    purchase_no VARCHAR(30) UNIQUE NOT NULL,
    purchase_date DATE NOT NULL,
    supplier_code VARCHAR(20) REFERENCES clients(client_code),
    product_name VARCHAR(200),
    quantity NUMERIC(15,2),
    unit_price NUMERIC(15,2),
    amount NUMERIC(15,2),
    currency VARCHAR(10) DEFAULT 'KRW',
    payment_status VARCHAR(20) DEFAULT '미지급',
    remarks TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 6. 무역 거래 테이블
CREATE TABLE trade_transactions (
    id SERIAL PRIMARY KEY,
    transaction_no VARCHAR(30) UNIQUE NOT NULL,
    transaction_type VARCHAR(20) NOT NULL,
    transaction_date DATE NOT NULL,
    client_code VARCHAR(20) REFERENCES clients(client_code),
    product_name VARCHAR(200),
    quantity NUMERIC(15,2),
    unit_price NUMERIC(15,2),
    amount NUMERIC(15,2),
    currency VARCHAR(10) DEFAULT 'USD',
    exchange_rate NUMERIC(10,4),
    krw_amount NUMERIC(15,2),
    customs_status VARCHAR(50),
    bl_no VARCHAR(50),
    remarks TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스 생성
CREATE INDEX idx_employees_code ON employees(employee_code);
CREATE INDEX idx_clients_code ON clients(client_code);
CREATE INDEX idx_sales_date ON sales(sales_date);
CREATE INDEX idx_purchases_date ON purchases(purchase_date);
CREATE INDEX idx_trade_date ON trade_transactions(transaction_date);

-- Row Level Security 비활성화
ALTER TABLE employees DISABLE ROW LEVEL SECURITY;
ALTER TABLE payroll DISABLE ROW LEVEL SECURITY;
ALTER TABLE clients DISABLE ROW LEVEL SECURITY;
ALTER TABLE sales DISABLE ROW LEVEL SECURITY;
ALTER TABLE purchases DISABLE ROW LEVEL SECURITY;
ALTER TABLE trade_transactions DISABLE ROW LEVEL SECURITY;
```

**Step 3: 실행 결과 확인**
```
✅ "Success. No rows returned" 메시지 확인
```

### 2.3 API 키 확인

**Step 1: Settings 메뉴 열기**
```
1. 좌측 메뉴에서 "Project Settings" 클릭
2. "API" 탭 선택
```

**Step 2: 연결 정보 복사**
```
📋 복사할 정보:
1. Project URL: https://xxxxxxxxxxxxx.supabase.co
2. anon public key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**⚠️ 중요: 이 정보는 안전하게 보관하세요!**

---

## 3. GitHub 저장소 생성 및 업로드

### 3.1 GitHub 저장소 생성

**Step 1: GitHub 웹사이트 접속**
```
1. https://github.com 로그인
2. 우측 상단 "+" 클릭
3. "New repository" 선택
```

**Step 2: 저장소 정보 입력**
```
Repository name: hr-accounting-system
Description: 기업용 인사회계 시스템
Visibility: Public (또는 Private)
Initialize this repository with: 체크 안 함
```

**Step 3: "Create repository" 클릭**

### 3.2 로컬에서 Git 초기화 및 업로드

**터미널/명령 프롬프트 열기**:

```bash
# 1. 프로젝트 폴더로 이동
cd hr-accounting-system

# 2. Git 초기화
git init

# 3. 원격 저장소 연결
git remote add origin https://github.com/your-username/hr-accounting-system.git
# ⚠️ your-username을 실제 GitHub 사용자명으로 변경

# 4. 파일 추가 (.gitignore에 의해 secrets.toml은 제외됨)
git add .

# 5. 커밋
git commit -m "Initial commit: HR Accounting System"

# 6. GitHub에 푸시
git push -u origin main
# 또는
git push -u origin master
```

**인증 방법**:

**Option 1: GitHub Personal Access Token 사용 (권장)**
```
1. GitHub 설정 > Developer settings > Personal access tokens
2. "Generate new token" 클릭
3. 권한 선택: repo (전체)
4. 생성된 토큰 복사
5. git push 시 비밀번호 대신 토큰 입력
```

**Option 2: SSH 키 사용**
```bash
# SSH 키 생성
ssh-keygen -t ed25519 -C "your-email@example.com"

# 공개 키 복사
cat ~/.ssh/id_ed25519.pub

# GitHub 설정 > SSH keys에 추가
```

### 3.3 업로드 확인

```
1. GitHub 저장소 페이지 새로고침
2. 다음 파일들이 보이는지 확인:
   ✅ hr_accounting_system.py
   ✅ requirements.txt
   ✅ README.md
   ✅ .gitignore
   ⛔ .streamlit/secrets.toml (이 파일은 보이면 안 됨!)
```

---

## 4. Streamlit Cloud 배포

### 4.1 Streamlit Cloud 접속

**Step 1: 로그인**
```
1. https://streamlit.io/cloud 접속
2. "Sign up" 또는 "Log in" 클릭
3. "Continue with GitHub" 선택
4. GitHub 계정으로 인증
```

**Step 2: GitHub 권한 승인**
```
1. Streamlit이 GitHub 저장소에 접근할 수 있도록 승인
2. "Authorize streamlit" 클릭
```

### 4.2 새 앱 배포

**Step 1: New app 생성**
```
1. 우측 상단 "New app" 버튼 클릭
2. "Deploy a public app from GitHub" 선택
```

**Step 2: 저장소 설정**
```
Repository: your-username/hr-accounting-system
Branch: main (또는 master)
Main file path: hr_accounting_system.py
```

**Step 3: App URL 설정 (선택사항)**
```
App URL (optional): hr-accounting-system
최종 URL: https://hr-accounting-system.streamlit.app
```

### 4.3 Secrets 설정 (중요!)

**Step 1: Advanced settings 클릭**

**Step 2: Secrets 입력**

아래 형식으로 Supabase 정보 입력:

```toml
SUPABASE_URL = "https://xxxxxxxxxxxxx.supabase.co"
SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**⚠️ 주의사항**:
- 따옴표(" ") 반드시 포함
- URL과 Key는 Supabase에서 복사한 정확한 값
- 줄바꿈 없이 정확하게 입력

**Step 3: Deploy 버튼 클릭**

### 4.4 배포 프로세스

```
1. 환경 구성 중... (약 1분)
   - Python 환경 설정
   - requirements.txt 패키지 설치

2. 앱 시작 중... (약 30초)
   - Streamlit 앱 실행
   - Supabase 연결 확인

3. 배포 완료! ✅
   - URL: https://your-app.streamlit.app
```

**배포 로그 확인**:
```
- 하단 "Logs" 탭에서 실시간 로그 확인
- 오류 발생 시 여기서 확인 가능
```

---

## 5. 배포 확인 및 테스트

### 5.1 기본 기능 테스트

**Step 1: 앱 접속**
```
1. 배포된 URL 클릭
2. 로딩 완료 대기 (처음에는 1-2분 소요 가능)
```

**Step 2: 대시보드 확인**
```
✅ 좌측 메뉴가 정상적으로 표시되는지 확인
✅ "데이터베이스 연결 실패" 오류가 없는지 확인
```

**Step 3: 직원 등록 테스트**
```
1. "👥 직원 관리" 메뉴 클릭
2. "직원 등록" 탭 선택
3. 테스트 데이터 입력:
   - 사번: TEST001
   - 이름: 홍길동
   - 부서: 테스트부
4. "✅ 등록" 버튼 클릭
5. 성공 메시지 확인
```

**Step 4: 데이터 조회 테스트**
```
1. "직원 목록" 탭 선택
2. 방금 등록한 직원이 표시되는지 확인
```

### 5.2 성능 확인

**페이지 로딩 속도**:
```
- 초기 로딩: 10-30초 (정상)
- 페이지 전환: 1-3초 (정상)
- 데이터 조회: 1-2초 (정상)
```

**느린 경우 원인**:
- Supabase 무료 플랜 (대기 시간)
- Streamlit Cloud 무료 플랜 (리소스 제한)
- 데이터양 증가

### 5.3 모바일 테스트

```
1. 스마트폰에서 URL 접속
2. 화면 크기에 맞게 조정되는지 확인
3. 터치 입력이 정상 작동하는지 확인
```

---

## 6. 문제 해결

### 6.1 일반적인 오류

#### ❌ "Module not found" 오류

**원인**: requirements.txt에 패키지 누락

**해결**:
```bash
# 1. requirements.txt 확인
cat requirements.txt

# 2. 누락된 패키지 추가
echo "missing-package==1.0.0" >> requirements.txt

# 3. GitHub에 푸시
git add requirements.txt
git commit -m "Add missing package"
git push

# 4. Streamlit Cloud에서 자동 재배포 대기
```

#### ❌ "데이터베이스 연결 실패" 오류

**원인**: Secrets 설정 오류

**해결**:
```
1. Streamlit Cloud 대시보드 접속
2. 앱 선택 > Settings > Secrets
3. SUPABASE_URL과 SUPABASE_KEY 확인
4. Supabase 대시보드에서 정확한 값 재복사
5. Secrets 수정 후 저장
6. 앱 자동 재시작 대기
```

#### ❌ "App timeout" 오류

**원인**: 앱 시작 시간 초과

**해결**:
```
1. 코드 최적화:
   - 불필요한 import 제거
   - @st.cache_resource 활용

2. Streamlit Cloud 재시작:
   - 앱 Settings > "Reboot app" 클릭
```

### 6.2 배포 로그 확인

**로그 보는 방법**:
```
1. Streamlit Cloud 대시보드
2. 앱 선택
3. 하단 "Logs" 탭 클릭
4. 실시간 로그 확인
```

**주요 확인 사항**:
```
✅ "App is live!" - 정상 작동
✅ "Supabase client initialized" - DB 연결 성공
❌ "Error" - 오류 발생 (상세 내용 확인)
❌ "Timeout" - 시간 초과
```

### 6.3 긴급 문제 해결

**앱이 작동하지 않을 때**:

```
1단계: 로컬에서 테스트
cd hr-accounting-system
streamlit run hr_accounting_system.py

2단계: 로컬에서 정상 작동하면
git add .
git commit -m "Fix deployment issue"
git push

3단계: Streamlit Cloud 재배포
- 자동 재배포 대기 (1-2분)

4단계: 그래도 안 되면
- Streamlit Cloud 앱 삭제
- 새로운 앱으로 재배포
```

---

## 7. 유지보수 및 업데이트

### 7.1 코드 수정 후 배포

```bash
# 1. 로컬에서 코드 수정
# 2. 테스트
streamlit run hr_accounting_system.py

# 3. Git 커밋 및 푸시
git add .
git commit -m "Update: 새로운 기능 추가"
git push

# 4. Streamlit Cloud 자동 재배포
# - GitHub push 감지 후 자동 재배포
# - 약 2-3분 소요
```

### 7.2 Secrets 업데이트

```
1. Streamlit Cloud 대시보드
2. 앱 선택 > Settings > Secrets
3. 값 수정
4. Save 클릭
5. 앱 자동 재시작
```

### 7.3 데이터베이스 백업

**Supabase 백업**:
```
1. Supabase 대시보드
2. Project Settings > Database
3. "Download backup" 클릭
4. .sql 파일 다운로드
5. 안전한 곳에 보관
```

---

## 8. 배포 체크리스트

### 배포 전 체크리스트

```
□ Python 코드 로컬 테스트 완료
□ requirements.txt 패키지 목록 확인
□ .gitignore에 secrets.toml 포함 확인
□ README.md 작성 완료
□ Supabase 데이터베이스 테이블 생성 완료
□ Supabase API 키 복사 완료
□ GitHub 저장소 생성 완료
```

### 배포 후 체크리스트

```
□ Streamlit Cloud 배포 성공 확인
□ 데이터베이스 연결 정상 확인
□ 모든 메뉴 작동 확인
□ 직원 등록 테스트 성공
□ 엑셀 업로드 테스트 성공
□ 모바일에서 접속 테스트 성공
□ 배포 URL 공유
```

---

## 9. 추가 참고사항

### 9.1 Streamlit Cloud 제한사항

**무료 플랜**:
- 앱 개수: 1개
- CPU: 1 core
- RAM: 1GB
- 저장공간: 제한적
- 슬립 모드: 7일 동안 미사용 시

**⚠️ 주의**:
- 7일 동안 접속이 없으면 앱이 슬립 모드로 전환
- 다시 접속 시 앱 재시작 (1-2분 소요)

### 9.2 Supabase 제한사항

**무료 플랜**:
- 데이터베이스: 500MB
- API 요청: 무제한 (합리적 사용)
- 스토리지: 1GB
- 프로젝트: 2개

### 9.3 추천 업그레이드

**트래픽이 많아지면**:
- Streamlit Cloud Pro: $20/month
- Supabase Pro: $25/month

---

**배포 가이드 버전**: 1.0  
**최종 수정일**: 2024년 11월  

*성공적인 배포를 기원합니다! 🚀*